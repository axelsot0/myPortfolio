<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Portfolio Tower</title>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GSAP para animaciones suaves -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #050505; /* Fondo negro muy oscuro */
            font-family: 'Space Mono', monospace;
            color: white;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Overlay de UI */
        #ui-layer {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Dejar pasar clicks al canvas si fuera necesario */
            display: flex;
        }

        /* Panel de Información (Derecha) */
        .info-panel {
            position: absolute;
            right: 5%;
            top: 80%; /* Posición baja para evitar solapamiento superior */
            transform: translateY(40%);
            width: 350px;
            pointer-events: auto;
        }

        .info-content {
            opacity: 0; /* Se maneja con GSAP/Vue */
        }

        /* --- EFECTO GRANULADO ESTILO CHALK/CARBONCILLO --- */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50; /* Asegurarse de que esté encima de todo */
            opacity: 0.3; /* Opacidad visible */
            background: transparent;
            mix-blend-mode: hard-light; /* hard-light ayuda a que el ruido "coma" el brillo */
        }
        
        .noise-overlay::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            /* baseFrequency='0.65' para grano grueso */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
            background-size: 150px 150px; /* Tamaño del patrón de ruido */
            animation: noiseMove 0.4s infinite linear; /* Movimiento sutil */
        }

        @keyframes noiseMove {
            0% { transform: translate(0,0); }
            10% { transform: translate(-5%,-5%); }
            20% { transform: translate(-10%,5%); }
            30% { transform: translate(5%,-10%); }
            40% { transform: translate(-5%,15%); }
            50% { transform: translate(-10%,5%); }
            60% { transform: translate(15%,0); }
            70% { transform: translate(0,10%); }
            80% { transform: translate(-15%,0); }
            90% { transform: translate(10%,5%); }
            100% { transform: translate(5%,0); }
        }

        .scroll-indicator {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            color: #666;
            font-size: 0.7rem;
            letter-spacing: 2px;
            z-index: 20;
            text-align: center;
            text-transform: uppercase;
        }

        .btn-repo {
            margin-top: 1.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.5);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            backdrop-filter: blur(5px);
        }
        
        .btn-repo:hover {
            border-color: white;
            background: white;
            color: black;
        }

        /* Pantalla de carga */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Space Mono', monospace;
        }
        
        .loader-text {
            animation: blink 1s infinite;
        }
        
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Estilos de texto */
        h1 { text-shadow: 0 0 15px rgba(255,255,255,0.5); }
        .tag { border: 1px solid #333; padding: 2px 6px; font-size: 0.65rem; color: #888; margin-right: 4px; }
    </style>
</head>
<body>

    <div id="app">
        <div class="noise-overlay"></div>
        
        <!-- Loading Screen -->
        <div v-if="loading" class="loading-screen">
            <div class="text-2xl mb-2 loader-text">INICIALIZANDO SISTEMA...</div>
            <div class="text-xs text-gray-500">CARGANDO DATOS DE ARQUITECTURA</div>
        </div>

        <div id="canvas-container" ref="canvasContainer"></div>

        <!-- UI Layer -->
        <div id="ui-layer" v-show="!loading">
            <div class="scroll-indicator">
                CLICK / SCROLL / KEYS<br>
                LEVEL: {{ currentLevel + 1 }} / {{ totalLevels }}
            </div>

            <!-- Panel Derecho -->
            <div class="info-panel" v-if="activeItem">
                <div class="info-content" ref="infoBox">
                    
                    <!-- Header decorativo (BLOCK_ID...) -->
                    <div class="text-xs text-gray-500 mb-2 tracking-widest border-b border-gray-800 pb-2">
                        BLOCK_ID: {{ currentLevel }} // {{ activeItem.type === 'about' ? 'SYS_ADMIN' : 'REPO_DATA' }}
                    </div>

                    <!-- Lógica para mostrar "About Me" -->
                    <div v-if="activeItem.type === 'about'">
                        <h1 class="text-5xl font-bold mb-6 leading-tight">{{ activeItem.title }}</h1>
                        <p class="text-gray-400 text-sm leading-relaxed mb-6">
                            {{ activeItem.description }}
                        </p>
                        <div class="grid grid-cols-2 gap-4 text-xs text-gray-500 mb-6">
                            <div>
                                <span class="block text-white mb-1">ROLE</span>
                                {{ activeItem.role }}
                            </div>
                            <div>
                                <span class="block text-white mb-1">LOC</span>
                                {{ activeItem.location }}
                            </div>
                        </div>

                        <!-- NUEVA SECCIÓN: SWIFT ICON + LINKEDIN -->
                        <div class="flex items-center gap-6 border-t border-gray-800 pt-4">
                            <!-- Swift Icon -->
                            <div class="flex flex-col justify-center group cursor-help" title="Swift Developer">
                                <span class="text-[10px] text-gray-600 mb-1 font-bold tracking-widest opacity-0 group-hover:opacity-100 transition-opacity duration-300">CORE</span>
                                <!-- Icono SVG de Swift -->
                                <svg class="w-8 h-8 text-white transition-transform transform hover:scale-110 hover:text-[#F05138]" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19.645 3.842c-.128-.084-.21-.222-.21-.378 0-.26.21-.464.464-.464.156 0 .294.082.378.21.78 1.19 1.29 2.54 1.49 3.97.36 2.56-.32 5.16-1.88 7.34C17.58 17.74 13.94 20 10.18 20c-3.76 0-7.4-2.26-9.7-6.32-.2-.36-.38-.72-.54-1.1.36.28.74.54 1.14.78 2.3 1.38 5.02 1.84 7.68 1.3.62-.12 1.22-.3 1.8-.54-1.98-.2-3.84-.98-5.4-2.24-.64-.52-1.2-1.1-1.7-1.74.48.1.98.16 1.48.16.98 0 1.94-.22 2.82-.62-1.72-.66-3.08-1.98-3.8-3.64-.14-.32-.26-.66-.36-1.02.46.22.96.36 1.48.42-.86-.66-1.54-1.48-2.02-2.42-.48-.94-.7-2-.62-3.08.02-.24.08-.48.16-.7.14.4.32.78.54 1.14 1.58 2.6 4.14 4.4 7.12 4.96.16.02.32.04.48.04.68 0 1.34-.14 1.94-.4.28-.12.54-.26.78-.44.58-.44 1.04-1 1.34-1.64.3-.64.4-1.36.28-2.06-.12-.7-.46-1.34-1-1.84-.54-.5-1.2-.8-1.92-.86-.72-.06-1.42.12-2.02.5-.06.04-.12.06-.2.06-.16 0-.3-.12-.3-.28 0-.06.02-.12.06-.16.5-1.1 1.28-2.04 2.24-2.76.96-.72 2.1-1.16 3.3-1.26.16 0 .3.12.3.28 0 .06-.02.12-.06.18-.54.62-.92 1.36-1.12 2.16-.2.8-.16 1.64.12 2.4z"/>
                                </svg>
                            </div>

                            <!-- LinkedIn Link -->
                            <a href="https://www.linkedin.com/in/axel-soto/" target="_blank" class="btn-repo flex items-center gap-3 !mt-0 group">
                                <svg class="w-4 h-4 fill-current group-hover:text-[#0077b5] transition-colors" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                <span class="text-xs tracking-wider">CONNECT // LINKEDIN</span>
                            </a>
                        </div>
                    </div>

                    <!-- Lógica para mostrar "Proyectos" (Repos) -->
                    <div v-else>
                        <h1 class="text-4xl font-bold mb-4">{{ activeItem.title }}</h1>
                        <p class="text-gray-400 text-sm leading-relaxed mb-4">
                            {{ activeItem.description }}
                        </p>
                        
                        <!-- Tags y Estadísticas -->
                        <div class="flex flex-wrap gap-2 mb-6">
                            <!-- Mostramos solo los 3 primeros lenguajes -->
                            <span v-for="tech in activeItem.tech.slice(0, 3)" :key="tech" class="tag">{{ tech }}</span>
                        </div>

                        <div class="flex gap-6 text-xs font-mono text-gray-500 mb-6">
                            <span>★ {{ activeItem.stars }} STARS</span>
                            <span>⑂ {{ activeItem.forks }} FORKS</span>
                        </div>

                        <a :href="activeItem.url" target="_blank" class="btn-repo">
                            VER EN GITHUB &rarr;
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

        /* --- CONFIGURACIÓN DE DATOS --- */
        const config = {
            about: {
                type: 'about',
                title: "HOLA, SOY DEV.",
                description: "Arquitecto de software especializado en experiencias inmersivas y sistemas escalables. Transformo código en estructuras visuales.",
                role: "Frontend Architect",
                location: "Ciudad de Mexico"
            },
            // 1. Lista Blanca para filtrar
            whitelist: [
                "RealStateApp",
                "Azis",
                "transporte_vial_rd"
            ],
            username: "axelsot0"
        };

        createApp({
            setup() {
                const currentLevel = ref(0);
                const canvasContainer = ref(null);
                const infoBox = ref(null);
                const isScrolling = ref(false);
                const loading = ref(true);
                const githubData = ref([]); // Almacena los datos crudos de la API

                // --- LÓGICA DE API DE GITHUB ---
                const fetchGithubData = async () => {
                    try {
                        // 1. Obtener lista de repos del usuario
                        const response = await fetch(`https://api.github.com/users/${config.username}/repos`);
                        if (!response.ok) throw new Error("Error al conectar con GitHub");
                        const allRepos = await response.json();

                        // 2. Filtrar por la whitelist
                        const filtered = allRepos.filter(repo => config.whitelist.includes(repo.name));

                        // 3. Enriquecer con lenguajes
                        const enrichedRepos = await Promise.all(filtered.map(async (repo) => {
                            let languages = [];
                            try {
                                const langResponse = await fetch(repo.languages_url);
                                const langData = await langResponse.json();
                                languages = Object.keys(langData); 
                            } catch (e) {
                                console.warn("No se pudieron cargar lenguajes para", repo.name);
                            }

                            return {
                                type: 'project',
                                title: repo.name,
                                description: repo.description || "Descripción no disponible.",
                                url: repo.html_url,
                                tech: languages.length > 0 ? languages : [repo.language || "Code"], 
                                stars: repo.stargazers_count,
                                forks: repo.forks_count
                            };
                        }));

                        githubData.value = enrichedRepos;
                        loading.value = false;
                        nextTick(() => initThree());

                    } catch (error) {
                        console.warn("Usando datos de respaldo debido a error de API:", error);
                        
                        // DATOS DE RESPALDO (Fallback)
                        // Esto asegura que la app funcione si la API falla
                        githubData.value = [
                            {
                                type: 'project',
                                title: "RealStateApp",
                                description: "Plataforma integral para la gestión y visualización de bienes raíces con mapas interactivos en tiempo real.",
                                url: "https://github.com/axelsot0/RealStateApp",
                                tech: ["JavaScript", "HTML", "CSS", "Python"],
                                stars: 12, forks: 4
                            },
                            {
                                type: 'project',
                                title: "Azis",
                                description: "Bot de automatización y asistencia virtual diseñado para optimizar flujos de trabajo repetitivos.",
                                url: "https://github.com/axelsot0/Azis",
                                tech: ["Python", "Shell", "Dockerfile"],
                                stars: 8, forks: 1
                            },
                            {
                                type: 'project',
                                title: "transporte_vial_rd",
                                description: "Análisis de datos y visualización del sistema de transporte vial en la República Dominicana.",
                                url: "https://github.com/axelsot0/transporte_vial_rd",
                                tech: ["Jupyter Notebook", "Python", "Pandas"],
                                stars: 25, forks: 6
                            }
                        ];
                        
                        loading.value = false;
                        nextTick(() => initThree());
                    }
                };

                
                // Combinamos About Me + Repos Filtrados de la API
                const displayItems = computed(() => [config.about, ...githubData.value]);
                const totalLevels = computed(() => displayItems.value.length);
                const activeItem = computed(() => displayItems.value[currentLevel.value]);

                // --- THREE.JS VARIABLES ---
                let scene, camera, renderer;
                let cubes = []; 
                let group;
                let glowSprite; 

                // Variables para Click/Hover
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();

                // --- PARAMETROS ---
                const GLOW_SIZE = 5.0; 
                const GLOW_OPACITY = 0.4;
                const EMISSIVE_INTENSITY_ACTIVE = 0.8; 
                const ACTIVE_POINT_LIGHT_COLOR = 0xffaaff;
                const ACTIVE_POINT_LIGHT_INTENSITY = 0.6;
                const ACTIVE_POINT_LIGHT_DISTANCE = 3;

                const createGlowTexture = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 64;
                    canvas.height = 64;
                    const context = canvas.getContext('2d');
                    const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32);
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
                    gradient.addColorStop(0.4, 'rgba(255, 255, 255, 0.3)');
                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    context.fillStyle = gradient;
                    context.fillRect(0, 0, 64, 64);
                    return new THREE.CanvasTexture(canvas);
                };

                // --- INTERACCIÓN MOUSE (Click & Hover) ---
                const onMouseMove = (event) => {
                    event.preventDefault();
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                    // Cambiar cursor si hover sobre cubo
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(cubes);
                    
                    if (intersects.length > 0) {
                        document.body.style.cursor = 'pointer';
                    } else {
                        document.body.style.cursor = 'default';
                    }
                };

                const onClick = (event) => {
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(cubes);

                    if (intersects.length > 0) {
                        // El primer objeto intersectado es el más cercano
                        const targetId = intersects[0].object.userData.id;
                        if (targetId !== undefined) {
                            currentLevel.value = targetId; // Actualizar nivel
                        }
                    }
                };

                // --- INICIALIZACIÓN DE THREE.JS ---
                const initThree = () => {
                    if (!canvasContainer.value) return;

                    scene = new THREE.Scene();
                    scene.fog = new THREE.FogExp2(0x050505, 0.02);

                    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
                    camera.position.set(6, 3, 8);
                    camera.lookAt(0, 0, 0);

                    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                    renderer.shadowMap.enabled = true;
                    
                    // Limpiar y añadir
                    canvasContainer.value.innerHTML = '';
                    canvasContainer.value.appendChild(renderer.domElement);
                    
                    // Listeners para interacción directa
                    renderer.domElement.addEventListener('mousemove', onMouseMove, false);
                    renderer.domElement.addEventListener('click', onClick, false);

                    // Luces
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
                    scene.add(ambientLight);

                    const spotLight = new THREE.SpotLight(0xffffff, 1);
                    spotLight.position.set(10, 20, 10);
                    spotLight.angle = 0.3;
                    spotLight.penumbra = 0.5;
                    spotLight.castShadow = true;
                    scene.add(spotLight);

                    const bottomLight = new THREE.PointLight(0xff00ff, 0.8, 20);
                    bottomLight.position.set(0, -5, 2);
                    scene.add(bottomLight);

                    // GLOW SPRITE
                    const glowMaterial = new THREE.SpriteMaterial({ 
                        map: createGlowTexture(),
                        color: 0xffffff,
                        transparent: true,
                        opacity: 0, 
                        blending: THREE.AdditiveBlending,
                        depthWrite: false
                    });
                    glowSprite = new THREE.Sprite(glowMaterial);
                    glowSprite.scale.set(GLOW_SIZE, GLOW_SIZE, 1);

                    // Construir Torre
                    group = new THREE.Group();
                    cubes = []; // Resetear array de cubos
                    
                    const geometry = new THREE.BoxGeometry(1, 1, 1);
                    const baseMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0x111111,
                        roughness: 0.7,
                        metalness: 0.2
                    });

                    displayItems.value.forEach((item, index) => {
                        const cube = new THREE.Mesh(geometry, baseMaterial.clone());
                        cube.position.y = (index * 1.1) - (totalLevels.value * 1.1 / 2); 
                        cube.castShadow = true;
                        cube.receiveShadow = true;
                        
                        cube.userData = { 
                            originalY: cube.position.y,
                            id: index,
                            pointLight: null
                        };

                        const edges = new THREE.EdgesGeometry(geometry);
                        const lineMat = new THREE.LineBasicMaterial({ color: 0x333333, transparent: true, opacity: 0.5 });
                        const line = new THREE.LineSegments(edges, lineMat);
                        cube.add(line);
                        cube.userData.edges = line;

                        cubes.push(cube);
                        group.add(cube);
                    });

                    scene.add(group);

                    // Iniciar
                    animate();
                    updateSceneState(0);
                    animateInfoIn();
                };

                const animate = () => {
                    requestAnimationFrame(animate);
                    if (group) group.rotation.y += 0.002;
                    renderer.render(scene, camera);
                };

                const updateSceneState = (activeIndex) => {
                    if (cubes[activeIndex]) {
                        const activeCube = cubes[activeIndex];
                        if (glowSprite.parent !== activeCube) {
                            activeCube.add(glowSprite);
                            glowSprite.position.set(0, 0, 0); 
                        }
                        gsap.to(glowSprite.material, { opacity: GLOW_OPACITY, duration: 0.5 });
                    }

                    cubes.forEach((cube, index) => {
                        const isTarget = index === activeIndex;
                        
                        const targetX = isTarget ? 1.5 : 0; 
                        const targetZ = isTarget ? 1.5 : 0;
                        
                        gsap.to(cube.position, {
                            x: targetX,
                            z: targetZ,
                            duration: 1,
                            ease: "power3.out"
                        });

                        gsap.to(cube.rotation, {
                            x: isTarget ? 0.1 : 0,
                            z: isTarget ? -0.1 : 0,
                            duration: 1.2
                        });

                        const material = cube.material;
                        const edgesMat = cube.userData.edges.material;

                        if (isTarget) {
                            gsap.to(material.color, { r: 1, g: 1, b: 1, duration: 0.4 });
                            gsap.to(material.emissive, { r: 1, g: 1, b: 1, duration: 0.4 });
                            gsap.to(material, { emissiveIntensity: EMISSIVE_INTENSITY_ACTIVE, duration: 0.4 });
                            
                            gsap.to(edgesMat.color, { r: 0, g: 0, b: 0, duration: 0.4 });
                            gsap.to(edgesMat, { opacity: 1, duration: 0.4 });

                            if (!cube.userData.pointLight) {
                                const pointLight = new THREE.PointLight(ACTIVE_POINT_LIGHT_COLOR, 0, ACTIVE_POINT_LIGHT_DISTANCE);
                                cube.add(pointLight);
                                cube.userData.pointLight = pointLight;
                                gsap.to(pointLight, { intensity: ACTIVE_POINT_LIGHT_INTENSITY, duration: 0.5, delay: 0.2 });
                            } else {
                                gsap.to(cube.userData.pointLight, { intensity: ACTIVE_POINT_LIGHT_INTENSITY, duration: 0.5, delay: 0.2 });
                            }

                        } else {
                            gsap.to(material.color, { r: 0.07, g: 0.07, b: 0.07, duration: 0.5 });
                            gsap.to(material.emissive, { r: 0, g: 0, b: 0, duration: 0.5 });
                            gsap.to(material, { emissiveIntensity: 0, duration: 0.5 });

                            gsap.to(edgesMat.color, { r: 0.3, g: 0.3, b: 0.3, duration: 0.5 });
                            gsap.to(edgesMat, { opacity: 0.3, duration: 0.5 });

                            if (cube.userData.pointLight) {
                                gsap.to(cube.userData.pointLight, { 
                                    intensity: 0, 
                                    duration: 0.5, 
                                    onComplete: () => {
                                        if (cube.userData.pointLight) {
                                            cube.remove(cube.userData.pointLight);
                                            cube.userData.pointLight = null;
                                        }
                                    } 
                                });
                            }
                        }
                    });

                    if (group) {
                        const targetGroupY = -(activeIndex * 1.1) + (totalLevels.value * 1.1 / 2);
                        gsap.to(group.position, {
                            y: targetGroupY,
                            duration: 1,
                            ease: "power2.inOut"
                        });
                    }
                };

                const animateInfoIn = () => {
                    if(infoBox.value) {
                        gsap.fromTo(infoBox.value, 
                            { opacity: 0, y: 20, filter: 'blur(8px)' }, 
                            { opacity: 1, y: 0, filter: 'blur(0px)', duration: 0.6, ease: "power2.out", delay: 0.1 }
                        );
                    }
                };

                const changeLevel = (dir) => {
                    const next = currentLevel.value + dir;
                    if (next >= 0 && next < totalLevels.value) {
                        currentLevel.value = next;
                    }
                };

                const handleWheel = (e) => {
                    if (isScrolling.value) return;
                    isScrolling.value = true;
                    const dir = e.deltaY > 0 ? 1 : -1;
                    changeLevel(dir);
                    setTimeout(() => { isScrolling.value = false; }, 800);
                };

                const handleKey = (e) => {
                    if (e.key === 'ArrowUp') changeLevel(-1);
                    if (e.key === 'ArrowDown') changeLevel(1);
                };

                watch(currentLevel, (newVal) => {
                    updateSceneState(newVal);
                    nextTick(() => animateInfoIn());
                });

                onMounted(() => {
                    fetchGithubData();
                    window.addEventListener('wheel', handleWheel);
                    window.addEventListener('keydown', handleKey);
                    window.addEventListener('resize', () => {
                        if (camera) {
                            camera.aspect = window.innerWidth / window.innerHeight;
                            camera.updateProjectionMatrix();
                            renderer.setSize(window.innerWidth, window.innerHeight);
                        }
                    });
                });

                return {
                    currentLevel,
                    canvasContainer,
                    infoBox,
                    activeItem,
                    totalLevels,
                    loading
                };
            }
        }).mount('#app');
    </script>
</body>
</html>